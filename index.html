<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Tower of Hanoi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: white;
        }
        .game-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #fdbb2d;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #ccc;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        .stat-item {
            font-size: 1.2rem;
        }
        .stat-value {
            font-weight: bold;
            color: #fdbb2d;
        }
        .game-board {
            display: flex;
            justify-content: space-around;
            height: 350px;
            margin: 30px 0;
            position: relative;
        }
        .tower {
            width: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .tower-base {
            height: 20px;
            width: 180px;
            background: #8B4513;
            border-radius: 5px;
        }
        .tower-rod {
            width: 20px;
            height: 250px;
            background: linear-gradient(to right, #8B4513, #A0522D, #8B4513);
            border-radius: 5px 5px 0 0;
            margin-top: -5px;
            position: relative;
            z-index: 1;
        }
        .disks-container {
            position: absolute;
            bottom: 20px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            z-index: 2;
            width: 180px;
            height: 250px;
        }
        .disk {
            height: 25px;
            border-radius: 12px;
            margin-bottom: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            transition: transform 0.4s cubic-bezier(.4,2,.6,1), left 0.4s, top 0.4s;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 2;
        }
        .disk:hover {
            transform: translateY(-2px);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        button:active {
            transform: translateY(1px);
        }
        .difficulty-select {
            margin: 20px 0;
        }
        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        .message {
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .win {
            background: rgba(0, 200, 0, 0.3);
            color: #7fff00;
        }
        .lose {
            background: rgba(200, 0, 0, 0.3);
            color: #ff4500;
        }
        .instructions {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: left;
        }
        .instructions h3 {
            margin-bottom: 10px;
            color: #fdbb2d;
        }
        .instructions ul {
            list-style-position: inside;
            padding-left: 10px;
        }
        .instructions li {
            margin-bottom: 8px;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 768px) {
            .game-board {
                height: 280px;
            }
            .tower {
                width: 30%;
            }
            .tower-rod {
                height: 200px;
            }
            .disks-container {
                height: 200px;
            }
            h1 {
                font-size: 2.2rem;
            }
            .controls, .difficulty-buttons {
                flex-wrap: wrap;
            }
        }
        /* Animation disk style */
        .flying-disk {
            position: fixed !important;
            pointer-events: none;
            z-index: 9999 !important;
            transition: transform 0.4s cubic-bezier(.4,2,.6,1), left 0.4s, top 0.4s;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Tower of Hanoi</h1>
        <div class="subtitle">Move all disks from the first tower to the last one</div>
        <div class="stats">
            <div class="stat-item">Moves: <span id="move-count" class="stat-value">0</span></div>
            <div class="stat-item">Limit: <span id="move-limit" class="stat-value">∞</span></div>
            <div class="stat-item">Disks: <span id="disk-count" class="stat-value">4</span></div>
        </div>
        <div class="difficulty-select">
            <h3>Select Difficulty:</h3>
            <div class="difficulty-buttons">
                <button id="easy-btn">Easy (Unlimited)</button>
                <button id="medium-btn">Medium</button>
                <button id="hard-btn">Hard (Optimal)</button>
            </div>
        </div>
        <div id="message" class="message hidden"></div>
        <div class="game-board">
            <div class="tower" id="tower-0">
                <div class="disks-container" id="disks-0"></div>
                <div class="tower-rod"></div>
                <div class="tower-base"></div>
            </div>
            <div class="tower" id="tower-1">
                <div class="disks-container" id="disks-1"></div>
                <div class="tower-rod"></div>
                <div class="tower-base"></div>
            </div>
            <div class="tower" id="tower-2">
                <div class="disks-container" id="disks-2"></div>
                <div class="tower-rod"></div>
                <div class="tower-base"></div>
            </div>
        </div>
        <div class="controls">
            <button id="restart-btn">Restart</button>
            <button id="solve-btn">Auto Solve</button>
            <button id="hint-btn">Hint</button>
        </div>
        <div class="instructions">
            <h3>How to Play:</h3>
            <ul>
                <li>Click on a tower to select it, then click on another tower to move the top disk</li>
                <li>You can only move one disk at a time</li>
                <li>A larger disk cannot be placed on top of a smaller disk</li>
                <li>Try to move all disks to the rightmost tower in the fewest moves possible</li>
            </ul>
        </div>
    </div>
    <script>
        // Game state
        const gameState = {
            towers: [[], [], []],
            selectedTower: null,
            moveCount: 0,
            moveLimit: null,
            numDisks: 4,
            gameOver: false,
            difficulty: 'easy'
        };

        // DOM elements
        const towersEl = [
            document.getElementById('disks-0'),
            document.getElementById('disks-1'),
            document.getElementById('disks-2')
        ];
        const moveCountEl = document.getElementById('move-count');
        const moveLimitEl = document.getElementById('move-limit');
        const diskCountEl = document.getElementById('disk-count');
        const messageEl = document.getElementById('message');
        // Buttons
        const easyBtn = document.getElementById('easy-btn');
        const mediumBtn = document.getElementById('medium-btn');
        const hardBtn = document.getElementById('hard-btn');
        const restartBtn = document.getElementById('restart-btn');
        const solveBtn = document.getElementById('solve-btn');
        const hintBtn = document.getElementById('hint-btn');
        // Disk colors
        const diskColors = [
            '#FF5252', // Red
            '#FF4081', // Pink
            '#E040FB', // Purple
            '#7C4DFF', // Deep Purple
            '#536DFE', // Indigo
            '#448AFF', // Blue
            '#40C4FF', // Light Blue
            '#18FFFF'  // Cyan
        ];

        // Animate disk movement
        function animateDiskMove(fromTower, toTower, callback) {
            const fromEl = towersEl[fromTower];
            const toEl = towersEl[toTower];
            const diskEl = fromEl.lastElementChild;
            if (!diskEl) {
                callback();
                return;
            }

            // Get bounding rectangles
            const diskRect = diskEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();

            // Calculate target position (stacked)
            const diskHeight = diskEl.offsetHeight;
            const diskIndex = gameState.towers[toTower].length; // where it will be after move
            const targetLeft = toRect.left + (toRect.width - diskEl.offsetWidth) / 2;
            const targetTop = toRect.bottom - diskHeight * (diskIndex + 1);

            // Clone disk for animation
            const flyingDisk = diskEl.cloneNode(true);
            flyingDisk.classList.add('flying-disk');
            flyingDisk.style.left = diskRect.left + 'px';
            flyingDisk.style.top = diskRect.top + 'px';
            flyingDisk.style.width = diskEl.offsetWidth + 'px';
            flyingDisk.style.height = diskEl.offsetHeight + 'px';
            document.body.appendChild(flyingDisk);

            // Remove disk from DOM immediately for smoothness
            diskEl.style.visibility = 'hidden';

            // Animate
            requestAnimationFrame(() => {
                flyingDisk.style.transform = `translate(${targetLeft - diskRect.left}px, ${targetTop - diskRect.top}px)`;
            });

            setTimeout(() => {
                document.body.removeChild(flyingDisk);
                diskEl.style.visibility = '';
                callback();
            }, 400);
        }

        // Initialize game
        function initGame() {
            gameState.towers = [[], [], []];
            gameState.selectedTower = null;
            gameState.moveCount = 0;
            gameState.gameOver = false;
            // Create disks
            for (let i = gameState.numDisks; i > 0; i--) {
                gameState.towers[0].push(i);
            }
            updateMoveCounter();
            renderTowers();
            messageEl.classList.add('hidden');
        }
        // Render towers with disks
        function renderTowers() {
            towersEl.forEach(tower => {
                tower.innerHTML = '';
            });
            for (let i = 0; i < 3; i++) {
                gameState.towers[i].forEach(diskSize => {
                    const disk = document.createElement('div');
                    disk.className = 'disk';
                    disk.style.width = `${30 + diskSize * 20}px`;
                    disk.style.background = `linear-gradient(to right, ${diskColors[diskSize - 1]}, ${adjustColor(diskColors[diskSize - 1], -30)})`;
                    disk.style.border = `2px solid ${adjustColor(diskColors[diskSize - 1], -50)}`;
                    disk.textContent = diskSize;
                    disk.addEventListener('click', () => {
                        if (!gameState.gameOver) {
                            handleTowerClick(i);
                        }
                    });
                    towersEl[i].appendChild(disk);
                });
            }
            // Highlight selected tower
            for (let i = 0; i < 3; i++) {
                document.getElementById(`tower-${i}`).style.opacity = '1';
            }
            if (gameState.selectedTower !== null) {
                document.getElementById(`tower-${gameState.selectedTower}`).style.opacity = '0.8';
            }
        }
        // Handle tower click
        function handleTowerClick(towerIndex) {
            if (gameState.selectedTower === null) {
                if (gameState.towers[towerIndex].length > 0) {
                    gameState.selectedTower = towerIndex;
                    renderTowers();
                }
            } else {
                if (isValidMove(gameState.selectedTower, towerIndex)) {
                    moveDiskAnimated(gameState.selectedTower, towerIndex, () => {
                        // Check win condition
                        if (checkWin()) {
                            gameState.gameOver = true;
                            showMessage('You Won!', 'win');
                        }
                        // Check move limit
                        if (gameState.moveLimit !== null && gameState.moveCount >= gameState.moveLimit && !gameState.gameOver) {
                            gameState.gameOver = true;
                            showMessage('Out of Moves! Try Again.', 'lose');
                        }
                    });
                } else {
                    gameState.selectedTower = null;
                    renderTowers();
                }
                gameState.selectedTower = null;
            }
        }
        // Check if move is valid
        function isValidMove(fromTower, toTower) {
            if (gameState.towers[fromTower].length === 0) return false;
            const fromDisk = gameState.towers[fromTower][gameState.towers[fromTower].length - 1];
            if (gameState.towers[toTower].length === 0) return true;
            const toDisk = gameState.towers[toTower][gameState.towers[toTower].length - 1];
            return fromDisk < toDisk;
        }
        // Move disk between towers with animation
        function moveDiskAnimated(fromTower, toTower, afterMove) {
            animateDiskMove(fromTower, toTower, () => {
                const disk = gameState.towers[fromTower].pop();
                gameState.towers[toTower].push(disk);
                gameState.moveCount++;
                updateMoveCounter();
                renderTowers();
                if (afterMove) afterMove();
            });
        }
        // For auto-solve: move disk instantly (but with animation)
        function moveDiskAuto(fromTower, toTower, afterMove) {
            animateDiskMove(fromTower, toTower, () => {
                const disk = gameState.towers[fromTower].pop();
                gameState.towers[toTower].push(disk);
                gameState.moveCount++;
                updateMoveCounter();
                renderTowers();
                if (afterMove) afterMove();
            });
        }
        // Update move counter display
        function updateMoveCounter() {
            moveCountEl.textContent = gameState.moveCount;
            moveLimitEl.textContent = gameState.moveLimit === null ? '∞' : gameState.moveLimit;
            diskCountEl.textContent = gameState.numDisks;
        }
        // Check win condition
        function checkWin() {
            return gameState.towers[2].length === gameState.numDisks;
        }
        // Show message
        function showMessage(text, type) {
            messageEl.textContent = text;
            messageEl.className = 'message';
            messageEl.classList.add(type);
        }
        // Utility function to adjust color brightness
        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => ('0' + Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
        }
        // Set difficulty
        function setDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            switch(difficulty) {
                case 'easy':
                    gameState.moveLimit = null;
                    gameState.numDisks = 4;
                    break;
                case 'medium':
                    gameState.moveLimit = 15;
                    gameState.numDisks = 4;
                    break;
                case 'hard':
                    gameState.moveLimit = 15;
                    gameState.numDisks = 5;
                    break;
            }
            initGame();
        }
        // Auto-solve function (using iterative algorithm)
        function autoSolve() {
            const buttons = [easyBtn, mediumBtn, hardBtn, restartBtn, solveBtn, hintBtn];
            buttons.forEach(btn => btn.disabled = true);
            if (gameState.moveCount > 0) {
                initGame();
            }
            const totalMoves = Math.pow(2, gameState.numDisks) - 1;
            let src = 0, aux = 1, dest = 2;
            if (gameState.numDisks % 2 === 0) {
                [aux, dest] = [dest, aux];
            }
            let moveStep = 0;
            function performMove() {
                if (moveStep >= totalMoves || gameState.gameOver) {
                    buttons.forEach(btn => btn.disabled = false);
                    return;
                }
                moveStep++;
                let moveFn;
                if (moveStep % 3 === 1) {
                    moveFn = () => makeLegalMoveAuto(src, dest, nextMove);
                } else if (moveStep % 3 === 2) {
                    moveFn = () => makeLegalMoveAuto(src, aux, nextMove);
                } else if (moveStep % 3 === 0) {
                    moveFn = () => makeLegalMoveAuto(aux, dest, nextMove);
                }
                moveFn();
            }
            function nextMove() {
                if (moveStep < totalMoves) {
                    setTimeout(performMove, 420);
                } else {
                    buttons.forEach(btn => btn.disabled = false);
                    gameState.gameOver = true;
                    showMessage('Auto Solve Complete!', 'win');
                }
            }
            function makeLegalMoveAuto(a, b, cb) {
                if (gameState.towers[a].length === 0) {
                    moveDiskAuto(b, a, cb);
                } else if (gameState.towers[b].length === 0) {
                    moveDiskAuto(a, b, cb);
                } else if (gameState.towers[a][gameState.towers[a].length - 1] < gameState.towers[b][gameState.towers[b].length - 1]) {
                    moveDiskAuto(a, b, cb);
                } else {
                    moveDiskAuto(b, a, cb);
                }
            }
            setTimeout(performMove, 500);
        }
        // Provide hint
        function provideHint() {
            for (let from = 0; from < 3; from++) {
                for (let to = 0; to < 3; to++) {
                    if (from !== to && isValidMove(from, to)) {
                        highlightTower(from);
                        setTimeout(() => highlightTower(to), 500);
                        return;
                    }
                }
            }
        }
        // Highlight tower
        function highlightTower(index) {
            const tower = document.getElementById(`tower-${index}`);
            tower.style.boxShadow = '0 0 15px 5px gold';
            setTimeout(() => {
                tower.style.boxShadow = '';
            }, 500);
        }
        // Event listeners
        easyBtn.addEventListener('click', () => setDifficulty('easy'));
        mediumBtn.addEventListener('click', () => setDifficulty('medium'));
        hardBtn.addEventListener('click', () => setDifficulty('hard'));
        restartBtn.addEventListener('click', initGame);
        solveBtn.addEventListener('click', autoSolve);
        hintBtn.addEventListener('click', provideHint);
        for (let i = 0; i < 3; i++) {
            document.getElementById(`tower-${i}`).addEventListener('click', () => {
                if (!gameState.gameOver) {
                    handleTowerClick(i);
                }
            });
        }
        setDifficulty('easy');
    </script>
</body>
</html>
